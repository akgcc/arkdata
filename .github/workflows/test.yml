name: Test Dependency Installation

on:
  workflow_dispatch:

jobs:
  test-deps:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
              
      - name: Create constraints file
        run: echo "numpy==1.23.3" > constraints.txt

      - name: Install dependencies with constraints
        run: |
          pip install torch==1.12.1 torchvision==0.13.1 imagesize==1.4.1 openmim==0.3.2 wheel --constraint requirements_avatars.txt
          python -m mim install mmcv-full==1.6.2
          python -m mim install mmdet==2.25.2
          python -m mim install mmpose==0.28.1
          pip install anime-face-detector==0.0.9 --constraint requirements_avatars.txt
          pip freeze

      - name: Verify import
        run: python -c "import numpy, imagesize, cv2, anime_face_detector"
